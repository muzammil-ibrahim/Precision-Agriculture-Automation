{"version":3,"file":"useResizeDetector.js","sources":["../src/useResizeDetector.ts"],"sourcesContent":["import { useEffect, useState, useRef, useCallback } from 'react';\r\nimport type { DebouncedFunc } from 'es-toolkit/compat';\r\n\r\nimport { getDimensions, patchResizeCallback, useCallbackRef, useRefProxy } from './utils.js';\r\n\r\nimport type { Dimensions, UseResizeDetectorReturn, useResizeDetectorProps } from './types.js';\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction useResizeDetector<T extends HTMLElement = any>({\r\n  skipOnMount = false,\r\n  refreshMode,\r\n  refreshRate = 1000,\r\n  refreshOptions,\r\n  handleWidth = true,\r\n  handleHeight = true,\r\n  targetRef,\r\n  observerOptions,\r\n  onResize,\r\n  disableRerender = false,\r\n}: useResizeDetectorProps<T> = {}): UseResizeDetectorReturn<T> {\r\n  // If `skipOnMount` is enabled, skip the first resize event\r\n  const skipResize = useRef<boolean>(skipOnMount);\r\n\r\n  // Wrap the `onResize` callback with a ref to avoid re-renders\r\n  const onResizeRef = useCallbackRef(onResize);\r\n\r\n  const [size, setSize] = useState<Dimensions>({\r\n    width: undefined,\r\n    height: undefined,\r\n  });\r\n\r\n  const sizeRef = useRef<Dimensions>({\r\n    width: undefined,\r\n    height: undefined,\r\n  });\r\n\r\n  // Create a proxy ref to handle conditional rendering and dynamic ref changes of the target element\r\n  const { refProxy, refElement } = useRefProxy<T>(targetRef);\r\n\r\n  const { box } = observerOptions || {};\r\n\r\n  const resizeCallback: ResizeObserverCallback = useCallback(\r\n    (entries: ResizeObserverEntry[]) => {\r\n      if (!handleWidth && !handleHeight) return;\r\n\r\n      if (skipResize.current) {\r\n        skipResize.current = false;\r\n        return;\r\n      }\r\n\r\n      // Only update the size if one of the observed dimensions has changed\r\n      const shouldSetSize = (prevSize: Dimensions, nextSize: Dimensions) =>\r\n        (handleWidth && prevSize.width !== nextSize.width) || (handleHeight && prevSize.height !== nextSize.height);\r\n\r\n      entries.forEach((entry) => {\r\n        const dimensions = getDimensions(entry, box);\r\n        if (disableRerender) {\r\n          if (shouldSetSize(sizeRef.current, dimensions)) {\r\n            sizeRef.current.width = dimensions.width;\r\n            sizeRef.current.height = dimensions.height;\r\n            onResizeRef?.({\r\n              width: dimensions.width,\r\n              height: dimensions.height,\r\n              entry,\r\n            });\r\n          }\r\n        } else {\r\n          setSize((prevSize) => {\r\n            if (!shouldSetSize(prevSize, dimensions)) return prevSize;\r\n            onResizeRef?.({\r\n              width: dimensions.width,\r\n              height: dimensions.height,\r\n              entry,\r\n            });\r\n            return dimensions;\r\n          });\r\n        }\r\n      });\r\n    },\r\n    [handleWidth, handleHeight, skipResize, box, disableRerender],\r\n  );\r\n\r\n  // Throttle/Debounce the resize event if refreshMode is configured\r\n  const resizeHandler = useCallback(patchResizeCallback(resizeCallback, refreshMode, refreshRate, refreshOptions), [\r\n    resizeCallback,\r\n    refreshMode,\r\n    refreshRate,\r\n    refreshOptions,\r\n  ]);\r\n\r\n  // Attach ResizeObserver to the element\r\n  useEffect(() => {\r\n    let resizeObserver: ResizeObserver | undefined;\r\n    if (refElement) {\r\n      try {\r\n        resizeObserver = new window.ResizeObserver(resizeHandler);\r\n        resizeObserver.observe(refElement, observerOptions);\r\n      } catch (error) {\r\n        console.warn('ResizeObserver not supported or failed to initialize:', error);\r\n      }\r\n    }\r\n    // If refElement is not available, reset the size\r\n    else if (size.width || size.height) {\r\n      onResizeRef?.({\r\n        width: null,\r\n        height: null,\r\n        entry: null,\r\n      });\r\n      sizeRef.current.width = undefined;\r\n      sizeRef.current.height = undefined;\r\n      if (!disableRerender) {\r\n        setSize({ width: undefined, height: undefined });\r\n      }\r\n    }\r\n\r\n    // Disconnect the ResizeObserver when the component is unmounted\r\n    return () => {\r\n      resizeObserver?.disconnect?.();\r\n      (resizeHandler as DebouncedFunc<ResizeObserverCallback>).cancel?.();\r\n    };\r\n  }, [resizeHandler, refElement]);\r\n\r\n  return { ref: refProxy, ...(disableRerender ? sizeRef.current : size) };\r\n}\r\n\r\nexport default useResizeDetector;\r\n"],"names":[],"mappings":"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"}